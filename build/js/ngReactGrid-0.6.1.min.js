/**
 * @license ngReactGrid v0.6.1
 * (c) 2010-2014 Jose Garcia - http://josebalius.github.io/ngReactGrid/
 * License: MIT
 */
if("undefined"==typeof _)var _={nativeForEach:Array.prototype.forEach,each:function(t,e,i){if(null==t)return t;if(this.nativeForEach&&t.forEach===this.nativeForEach)t.forEach(e,i);else if(t.length===+t.length){for(var r=0,a=t.length;a>r;r++)if(e.call(i,t[r],r,t)===breaker)return}else for(var n=_.keys(t),r=0,a=n.length;a>r;r++)if(e.call(i,t[n[r]],n[r],t)===breaker)return;return t},slice:Array.prototype.slice,extend:function(t){return this.each(this.slice.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t}};angular.module("ngReactGrid",[]).directive("ngReactGrid",["ngReactGrid",function(t){return{restrict:"E",link:function(e,i,r){new t(e,i,r)}}}]).factory("ngReactGridCheckbox",function(){var t=function(t){return{field:"",fieldName:"",render:function(e){var i=function(){var i=t.indexOf(e);-1===i?t.push(e):t.splice(i,1)};return ngReactGridCheckboxComponent({selectionTarget:t,handleClick:i,row:e})},sort:!1,width:1}};return t}).factory("ngReactGrid",["$rootScope",function(t){var e="localMode is false, please implement the getData function on the grid object",i=function(t,e){this.ngReactGrid=e,this.grid=t,this.showingRecords=0,this.startIndex=0,this.endIndex=0,this.originalData=[],this.loading=!1};i.prototype.setPageSize=function(i){t.$apply(function(){var t={pageSize:i,currentPage:1};if(this.grid.search.length>0?(t.data=this.filteredData,this.ngReactGrid.update(t,!1,!0)):this.ngReactGrid.update(t),!this.grid.localMode){if(!this.grid.getData)throw new Error(e);this.loading=!0,this.grid.getData()}this.ngReactGrid.render()}.bind(this))},i.prototype.setSortField=function(i){t.$apply(function(){if(this.grid.sortInfo.field!==i?(this.grid.sortInfo.field=i,this.grid.sortInfo.dir="asc"):this.grid.sortInfo.dir="asc"===this.grid.sortInfo.dir?"desc":"asc",this.grid.localMode)this.sort();else{if(!this.grid.getData)throw new Error(e);this.loading=!0,this.grid.getData(),this.ngReactGrid.render()}}.bind(this))},i.prototype.sort=function(){var t;t=this.grid.search.length>0?this.filteredData:this.grid.react.originalData.slice(0);var e="asc"===this.grid.sortInfo.dir;t.sort(function(t,i){return e?t[this.grid.sortInfo.field]<=i[this.grid.sortInfo.field]?-1:1:t[this.grid.sortInfo.field]>=i[this.grid.sortInfo.field]?-1:1}.bind(this)),this.ngReactGrid.update({data:t,currentPage:1},!1,!0),this.ngReactGrid.render()},i.prototype.setSearch=function(i){t.$apply(function(){if(this.ngReactGrid.update({search:i}),i=String(i).toLowerCase(),this.grid.localMode){this.grid.data=this.originalData.slice(0);var t=this.grid.data.filter(function(t){var e=!1;for(var r in t)if(t.hasOwnProperty(r)&&-1!==String(t[r]).toLowerCase().indexOf(i)){e=!0;break}return e});this.filteredData=t,this.ngReactGrid.update({data:t,currentPage:1},!1,!0)}else{if(!this.grid.getData)throw new Error(e);this.loading=!0,this.grid.getData()}this.ngReactGrid.render()}.bind(this))},i.prototype.goToPage=function(i){t.$apply(function(){if(this.ngReactGrid.update({data:this.grid.search.length>0?this.filteredData:this.originalData,currentPage:i},!1,!0),!this.grid.localMode){if(!this.grid.getData)throw new Error(e);this.loading=!0,this.grid.getData()}this.ngReactGrid.render()}.bind(this))},i.prototype.wrapFunctionsInAngular=function(t){for(var e in t.props)t.props.hasOwnProperty(e)&&("children"===e?this.wrapFunctionsInAngular(t.props[e]):"function"==typeof t.props[e]&&(t.props[e]=this.wrapWithRootScope(t.props[e])));return t},i.prototype.wrapWithRootScope=function(e){return function(){t.$apply(function(){e()})}};var r=function(t){return this.columnDefs=[],this.data=[],this.height=500,this.localMode=!0,this.totalCount=0,this.totalPages=0,this.currentPage=1,this.pageSize=25,this.pageSizes=[25,50,100,500],this.sortInfo={field:"",dir:""},this.search="",this.horizontalScroll=!1,this.scrollbarWidth=function(){var t=document.createElement("div");t.style.visibility="hidden",t.style.width="100px",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);var e=t.offsetWidth;t.style.overflow="scroll";var i=document.createElement("div");i.style.width="100%",t.appendChild(i);var r=i.offsetWidth;return t.parentNode.removeChild(t),e-r}(),this.react=new i(this,t),this},a=function(t,e,i){this.scope=t,this.element=e[0],this.attrs=i,this.grid=new r(this),this.initWithGetData=!1,this.update(t.grid,!0),t.$watch("grid.data",function(t){t&&(this.update({data:t},!0),this.render())}.bind(this)),t.$watch("grid.totalCount",function(t){t&&(this.update({totalCount:t},!0),this.render())}.bind(this)),this.grid.getData&&(this.initWithGetData=!0,this.grid.react.loading=!0,this.grid.getData(this.grid)),this.render()};return a.prototype.update=function(t,e,i){for(var r in t)if(t.hasOwnProperty(r)&&"react"===r)throw new Error("Trying to update the grid with the reserved 'react' property");this.grid=_.extend(this.grid,t),e&&(this.grid.react.originalData=this.grid.data.slice(0));var a=(this.grid.currentPage-1)*this.grid.pageSize,n=this.grid.pageSize*this.grid.currentPage;this.grid.localMode&&(i?(this.grid.totalCount=t.data.length,this.grid.data=t.data.slice(a,n)):(this.grid.totalCount=this.grid.react.originalData.length,this.grid.data=this.grid.react.originalData.slice(a,n))),this.grid.react.showingRecords=this.grid.data.length,this.grid.react.startIndex=a,this.grid.react.endIndex=n,this.initWithGetData?this.initWithGetData=!1:this.grid.react.loading=!1,this.grid.totalPages=Math.ceil(this.grid.totalCount/this.grid.pageSize)},a.prototype.render=function(){React.renderComponent(ngReactGridComponent({grid:this.grid}),this.element)},a}]);var ngReactGridComponent=function(){var t=window.innerWidth,e=(window.innerHeight,function(e){var i=String(e.width).replace("px",""),r=-1!==i.indexOf("%");if(r){var a=Math.floor(parseInt(i)*t/100);e.width=a}}),i=function(t,i,r){i.width||(i.width="10%"),t.horizontalScroll&&e(i),r.width=i.width},r=function(){var t=React.createClass({displayName:"ngGridHeaderCell",getInitialState:function(){return{width:0}},cellStyle:{},handleClick:function(){this.props.grid.react.setSortField(this.props.cell.field)},componentWillReceiveProps:function(){i(this.props.grid,this.props.cell,this.cellStyle,this.props.last),this.setState({width:this.cellStyle.width})},componentWillMount:function(){i(this.props.grid,this.props.cell,this.cellStyle,this.props.last),this.setState({width:this.cellStyle.width})},resize:function(t){console.debug(t)},componentDidMount:function(){{var t=this.getDOMNode();t.querySelector(".ngGridHeaderResizeControl"),document.getElementsByTagName("head")[0]}},render:function(){var t=this.cellStyle,e={cursor:"pointer",width:"8%","float":"left",textAlign:"right",display:this.props.cell.sort===!1?"none":""},i={marginTop:3},r="icon-arrows";this.props.grid.sortInfo.field===this.props.cell.field?(r+="asc"===this.props.grid.sortInfo.dir?" icon-asc":" icon-desc",i.marginTop=5):r+=" icon-both";var a={height:"21px",marginTop:"-4px",width:"1px",background:"#999999",borderRight:"1px solid #FFF","float":"right"},n={width:"2%",cursor:"col-resize",display:"none"};return React.DOM.th({title:this.props.cell.displayName,style:t},React.DOM.div({className:"ngGridHeaderCellText",onClick:this.handleClick},this.props.cell.displayName),React.DOM.div({style:e},React.DOM.i({className:r,style:i})),React.DOM.div({style:n,className:"ngGridHeaderResizeControl"},React.DOM.div({className:"ngGridHeaderCellResize",style:a})))}}),e=React.createClass({displayName:"ngReactGridShowPerPage",handleChange:function(){this.props.grid.react.setPageSize(this.refs.showPerPage.getDOMNode().value)},render:function(){var t=this.props.grid.pageSizes.map(function(t,e){return React.DOM.option({value:t,key:e},t)}.bind(this));return React.DOM.div({className:"ngReactGridShowPerPage"},"Show ",React.DOM.select({onChange:this.handleChange,ref:"showPerPage",value:this.props.grid.pageSize},t)," entries")}}),r=React.createClass({displayName:"ngReactGridSearch",handleSearch:function(){this.props.grid.react.setSearch(this.refs.searchField.getDOMNode().value)},render:function(){return React.DOM.div({className:"ngReactGridSearch"},React.DOM.input({type:"input",placeholder:"Search...",ref:"searchField",onKeyUp:this.handleSearch}))}}),a=React.createClass({displayName:"ngReactGridHeader",render:function(){var i=this.props.grid.columnDefs.length,a=this.props.grid.columnDefs.map(function(e,r){var a=i-1===r;return t({key:r,cell:e,index:r,grid:this.props.grid,last:a})}.bind(this)),n={width:"calc(100% - "+this.props.grid.scrollbarWidth+"px)"},s={paddingRight:this.props.grid.horizontalScroll?this.props.grid.scrollbarWidth:0};return React.DOM.div(null,React.DOM.div({className:"ngReactGridHeaderToolbarWrapper"},e({grid:this.props.grid,setGridState:this.props.setGridState}),r({grid:this.props.grid})),React.DOM.div({className:"ngReactGridHeaderWrapper"},React.DOM.div({className:"ngReactGridHeader",style:s},React.DOM.div({className:"ngReactGridHeaderInner"},React.DOM.table({style:n},React.DOM.thead(null,React.DOM.tr(null,a)))))))}});return a}(),a=function(){var t=React.createClass({displayName:"ngReactGridBodyRowCell",handleClick:function(){this.props.grid.react.cell.events.onClick(this.props.cell,this.props.row)},render:function(){var t=this.props.row[this.props.cell.field],e={};return i(this.props.grid,this.props.cell,e,this.props.last,!0),this.props.cell.render?(t=this.props.cell.render(this.props.row),cellTextType=typeof t,"string"===cellTextType?React.DOM.td({style:e},t):"object"===cellTextType?(t=this.props.grid.react.wrapFunctionsInAngular(t),React.DOM.td({style:e},t)):void 0):React.DOM.td({style:e,title:t,onClick:this.handleClick},React.DOM.div(null,t))}}),e=React.createClass({displayName:"ngReactGridBodyRow",render:function(){var e=this.props.grid.columnDefs.length,i=this.props.grid.columnDefs.map(function(i,r){var a=e-1===r;return t({key:r,cell:i,row:this.props.row,grid:this.props.grid,last:a})}.bind(this));return React.DOM.tr(null,i)}}),r=React.createClass({displayName:"ngReactGridBody",getInitialState:function(){return{fullRender:!1,needsUpdate:!1}},calculateIfNeedsUpdate:function(){this.props.grid.data.length>100&&this.setState({needsUpdate:!0})},performFullRender:function(){this.state.needsUpdate&&setTimeout(function(){this.setState({fullRender:!0,needsUpdate:!1})}.bind(this),0)},componentWillMount:function(){this.calculateIfNeedsUpdate()},componentWillReceiveProps:function(){this.calculateIfNeedsUpdate()},componentDidMount:function(){var t=this.getDOMNode(),e=document.querySelector(".ngReactGridHeaderInner"),i=document.querySelector(".ngReactGridViewPort");t.firstChild.addEventListener("scroll",function(){e.scrollLeft=i.scrollLeft}),this.performFullRender()},componentDidUpdate:function(){this.performFullRender()},render:function(){var t,i=function(t,i){return e({key:i,row:t,columns:this.props.columnDefs,grid:this.props.grid})}.bind(this);if(this.props.grid.react.loading){var r={textAlign:"center"};t=React.DOM.tr(null,React.DOM.td({colSpan:this.props.grid.columnDefs.length,style:r},"Loading..."))}else if(t=this.state.fullRender?this.props.grid.data.map(i):this.props.grid.data.slice(0,100).map(i),0===this.props.grid.react.showingRecords){var a={textAlign:"center"};t=React.DOM.tr(null,React.DOM.td({colSpan:this.props.grid.columnDefs.length,style:a},"No records found"))}var n={},s={};return this.props.grid.horizontalScroll?s.width="calc(100% - "+this.props.grid.scrollbarWidth+"px)":n.overflowX="hidden",React.DOM.div({className:"ngReactGridBody"},React.DOM.div({className:"ngReactGridViewPort",style:n},React.DOM.div({className:"ngReactGridInnerViewPort"},React.DOM.table({style:s},React.DOM.tbody(null,t)))))}});return r}(),n=function(){var t=React.createClass({displayName:"ngReactGridStatus",render:function(){return React.DOM.div({className:"ngReactGridStatus"},React.DOM.div(null,"Page ",React.DOM.strong(null,this.props.grid.currentPage)," of ",React.DOM.strong(null,this.props.grid.totalPages)," - Showing ",React.DOM.strong(null,this.props.grid.react.showingRecords)," of ",React.DOM.strong(null,this.props.grid.totalCount)," records"))}}),e=React.createClass({displayName:"ngReactGridPagination",goToPage:function(t){this.props.grid.react.goToPage(t)},goToLastPage:function(){this.goToPage(this.props.grid.totalPages)},goToFirstPage:function(){this.goToPage(1)},goToNextPage:function(){var t=this.props.grid.currentPage+1,e=this.props.grid.totalPages-t;e>=0&&this.goToPage(t)},goToPrevPage:function(){var t=this.props.grid.currentPage-1;t>0&&this.goToPage(t)},render:function(){for(var t=2,e=this.props.grid.totalPages,i=this.props.grid.currentPage,r=0>=i-t?1:i-t,a=i+t>=e?e:i+t,n=[],s=r;a>=s;s++)n.push(s);return n=n.map(function(t,e){var i=t===this.props.grid.currentPage?"active":"";return React.DOM.li({key:e,className:i,dataPage:t},React.DOM.a({href:"javascript:",onClick:this.goToPage.bind(null,t)},t))}.bind(this)),React.DOM.div({className:"ngReactGridPagination"},React.DOM.ul(null,React.DOM.li(null,React.DOM.a({href:"javascript:",onClick:this.goToPrevPage},"Prev")),React.DOM.li(null,React.DOM.a({href:"javascript:",onClick:this.goToFirstPage},"First")),n,React.DOM.li(null,React.DOM.a({href:"javascript:",onClick:this.goToLastPage},"Last")),React.DOM.li(null,React.DOM.a({href:"javascript:",onClick:this.goToNextPage},"Next"))))}}),i=React.createClass({displayName:"ngReactGridFooter",render:function(){return React.DOM.div({className:"ngReactGridFooter"},t({grid:this.props.grid}),e({grid:this.props.grid}))}});return i}(),s=React.createClass({displayName:"ngReactGrid",render:function(){return React.DOM.div({className:"ngReactGrid"},r({grid:this.props.grid}),a({grid:this.props.grid}),n({grid:this.props.grid}))}});return s}(),ngReactGridCheckboxComponent=function(){var t=React.createClass({displayName:"ngReactGridCheckboxComponent",getInitialState:function(){return{checked:!1}},handleClick:function(){this.setState({checked:this.state.checked?!1:!0}),this.props.handleClick()},componentWillReceiveProps:function(t){this.setState({checked:-1===t.selectionTarget.indexOf(t.row)?!1:!0})},render:function(){var t={textAlign:"center"};return React.DOM.div({style:t},React.DOM.input({type:"checkbox",onChange:this.handleClick,checked:this.state.checked}))}});return t}();